<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kdub Productions</title>
    <link rel="stylesheet" href="mainstyle.css">
</head>
<body>
    <div id="maindiv">
        <!-- Header Section -->
        <div class="heading_1_div">
            <h2 class="heading_1">Kdub Productions</h2>
            <p class="artist-header">Artists</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-button active" data-target="#videos-tab">Videos</button>
            <button class="tab-button" data-target="#mixtapes-tab">Mixtapes</button>
        </div>

        <!-- Tab Contents -->
        <div class="tab-content active" id="videos-tab">
            <div class="grid-container" id="video-grid"></div>
        </div>
        <div class="tab-content" id="mixtapes-tab">
            <div class="grid-container" id="mixtape-grid"></div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button id="prev-btn" onclick="previousPage()">Previous</button>
            <button id="next-btn" onclick="nextPage()">Next</button>
        </div>

        <!-- Pop-up for Playlist Tracks -->
        <div id="popup" class="popup">
            <div class="popup-content">
                <span class="close-btn" onclick="closePopup()">&times;</span>
                <h3>Playlist Tracks</h3>
                <ul id="track-list"></ul>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyBWXAiWVwtsv3lrMKC3eXSQs7UqjSVWLt8"; // Replace with your YouTube API key
        const channelId = "UCxLInTOesiaJPHRcr-q56aQ"; // Replace with your YouTube channel ID
        const videosPerPage = 12;
        let videos = [];
        let playlists = [];
        let nextPageToken = "";
        let prevPageToken = "";

        // Fetch all playlists from the channel
        async function fetchPlaylists(pageToken = "") {
            const url = `https://www.googleapis.com/youtube/v3/playlists?key=${apiKey}&channelId=${channelId}&part=snippet&maxResults=${videosPerPage}&pageToken=${pageToken}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    console.error("API Error:", data.error.message);
                    alert("An error occurred: " + data.error.message);
                    return;
                }

                playlists = data.items.map(item => ({
                    id: item.id,
                    title: item.snippet.title,
                    thumbnail: item.snippet.thumbnails.medium.url
                }));

                nextPageToken = data.nextPageToken || null;
                prevPageToken = data.prevPageToken || null;

                showPlaylists();
            } catch (error) {
                console.error("Fetch Error:", error);
                alert("Failed to fetch playlists. Check the console for details.");
            }
        }

        // Display playlists as thumbnails
        function showPlaylists() {
            const gridContainer = document.getElementById("mixtape-grid");
            gridContainer.innerHTML = ""; // Clear current content

            playlists.forEach(playlist => {
                const gridItem = document.createElement("div");
                gridItem.classList.add("grid-item");

                const thumbnail = document.createElement("img");
                thumbnail.src = playlist.thumbnail;
                thumbnail.alt = playlist.title;
                thumbnail.classList.add("mixtape-thumbnail");
                thumbnail.loading = "lazy"; // Enable lazy loading for better performance

                const description = document.createElement("p");
                description.textContent = playlist.title;

                // Make the thumbnail clickable to show the playlist's videos
                thumbnail.addEventListener('click', () => {
                    fetchPlaylistVideos(playlist.id);
                });

                gridItem.appendChild(thumbnail);
                gridItem.appendChild(description);

                gridContainer.appendChild(gridItem);
            });

            updateButtonStates();
        }

        // Fetch videos from a specific playlist
        async function fetchPlaylistVideos(playlistId) {
            const url = `https://www.googleapis.com/youtube/v3/playlistItems?key=${apiKey}&playlistId=${playlistId}&part=snippet&maxResults=${videosPerPage}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    console.error("API Error:", data.error.message);
                    alert("An error occurred: " + data.error.message);
                    return;
                }

                videos = data.items.map(item => ({
                    src: `https://www.youtube.com/embed/${item.snippet.resourceId.videoId}`,
                    title: item.snippet.title,
                    thumbnail: item.snippet.thumbnails.medium.url
                }));

                showVideos();
            } catch (error) {
                console.error("Fetch Error:", error);
                alert("Failed to fetch playlist videos. Check the console for details.");
            }
        }

        // Show videos from the selected playlist
        function showVideos() {
            const gridContainer = document.getElementById("video-grid");
            gridContainer.innerHTML = ""; // Clear current content

            videos.forEach(video => {
                const gridItem = document.createElement("div");
                gridItem.classList.add("grid-item");

                const iframe = document.createElement("iframe");
                iframe.src = video.src;
                iframe.allowFullscreen = true;

                const description = document.createElement("p");
                description.innerHTML = `<strong>Song:</strong> ${video.title}`;

                gridItem.appendChild(iframe);
                gridItem.appendChild(description);

                gridContainer.appendChild(gridItem);
            });

            updateButtonStates();
        }

        // Handle pagination
        function nextPage() {
            if (nextPageToken) {
                fetchPlaylists(nextPageToken);
            }
        }

        function previousPage() {
            if (prevPageToken) {
                fetchPlaylists(prevPageToken);
            }
        }

        // Update pagination buttons
        function updateButtonStates() {
            document.getElementById("prev-btn").style.display = prevPageToken ? "inline-block" : "none";
            document.getElementById("next-btn").style.display = nextPageToken ? "inline-block" : "none";
        }

        // Pop-up functionality
        function openPopup(tracks) {
            const trackList = document.getElementById("track-list");
            trackList.innerHTML = ""; // Clear previous track list

            tracks.forEach(track => {
                const li = document.createElement("li");
                li.textContent = track.title;
                trackList.appendChild(li);
            });

            document.getElementById("popup").style.display = "block";
        }

        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }

        // Add event listeners for tab switching
        document.addEventListener('DOMContentLoaded', () => {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    button.classList.add('active');
                    const targetContent = document.querySelector(button.getAttribute('data-target'));
                    targetContent.classList.add('active');
                });
            });

            fetchPlaylists(); // Initial fetch for playlists
        });
    </script>

    <!-- Pop-up Styles -->
    <style>
        /* Pop-up Styles */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background-color: #34495e;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            color: #fff;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .popup-content h3 {
            font-size: 2rem;
            color: #f1c40f;
            margin-bottom: 20px;
        }

        .popup-content ul {
            list-style-type: none;
            padding: 0;
        }

        .popup-content li {
            font-size: 1.2rem;
            margin: 10px 0;
            color: #ddd;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #f1c40f;
        }
    </style>
</body>
</html>
